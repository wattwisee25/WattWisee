<header>
  <app-menu></app-menu>
</header>

<div class="building-info-container">
  <!-- Loader -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="!isLoading && errorMessage" class="error">
    <p>{{ errorMessage }}</p>
  </div>

  <div class="container-info-chart">
    <!-- BUILDING INFO -->
    <div class="card-building">
      <div *ngIf="!isLoading && selectedBuilding" class="card-building-body building-info">
        <div class="left">
          <h2>{{ selectedBuilding.name }}</h2>
          <div class="image-wrapper">
            <img *ngIf="selectedBuilding.imageUrl" [src]="selectedBuilding.imageUrl"
              alt="{{ selectedBuilding.name }}" />
          </div>
        </div>

        <div class="right">
          <div class="title-right">
            <h4>Info</h4>
            <a class="view-link" [routerLink]="['/building-info', selectedBuilding._id]">View</a>
            <a class="edit-link" [routerLink]="['/edit-building-info', selectedBuilding._id]">Edit</a>
          </div>

          <div *ngIf="!isEditing" class="view-mode">
            <p>
              <strong>Name:</strong> {{ selectedBuilding.name }} <br />
              <strong>MPRN:</strong> {{ selectedBuilding.mprn }} <br />
              <strong>Address:</strong> {{ selectedBuilding.address }} <br />
              <strong>City:</strong> {{ selectedBuilding.city }} <br />
              <!-- <strong>Surface:</strong> {{ selectedBuilding.surface }} <br />
              <strong>NÂ° floors:</strong> {{ selectedBuilding.floors }} <br /> -->
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- BILLS SECTION RACCHIUSA IN CARD -->
    <div class="card-building bills-card" *ngIf="!isLoading && selectedBuilding">
      <div class="card-building-body">
        <h3>Bills</h3>
        <div class="bill-types">
          <button class="bill" [routerLink]="['/bills', selectedBuilding._id, 'electricity']">Electricity</button>
          <button class="bill" [routerLink]="['/bills', selectedBuilding._id, 'oil']">Oil - Fuel</button>
          <button class="bill" [routerLink]="['/bills', selectedBuilding._id, 'lpg']">LPG</button>
        </div>
      </div>
    </div>
  </div>


  <!-- CHARTS -->
  <div class="charts">
    <div class="year-navigation">
      <button (click)="changeYear(-1)" class="btn-year">&#8592; Previous Year</button>
      <span class="selected-year">{{ selectedYear }}</span>
      <button (click)="changeYear(1)" class="btn-year">Next Year &#8594;</button>
    </div>

    <!-- PIE CHART -->
    <div class="card-building card-building-chart" [class.expanded]="isPieExpanded">
      <div class="card-building-body pie_chart" *ngIf="selectedBuilding">

        <div class="pie-line-header">
          <h3>Energy Consumption</h3>

          <button class="btn-expand" (click)="togglePieExpand()">
            <i class="bi" [ngClass]="isPieExpanded ? 'bi-arrows-angle-contract' : 'bi-arrows-angle-expand'">
            </i>
          </button>

        </div>

        <div class="container_data">
          <div class="pie-wrapper">
            <canvas #pieChart></canvas>
          </div>
        </div>

      </div>
    </div>


    <!-- LINE CHART -->
    <div class="card-building card-building-chart" [class.expanded]="isLineExpanded">
      <div class="card-building-body line_chart" *ngIf="selectedBuilding">

        <!-- TOGGLE kWh / Cost -->
        <div class="toggle-container">
          <button (click)="toggleChart()">
            {{ lineChartMode === 'kwh' ? 'Cost' : 'kWh' }}
          </button>
        </div>

        <!-- HEADER -->
        <div class="pie-line-header">
          <h3>
            {{ lineChartMode === 'kwh' ? 'kWh Distribution' : 'Cost Distribution' }}
          </h3>

          <button class="btn-expand" (click)="toggleLineExpand()">
            <i class="bi" [ngClass]="
            isLineExpanded
              ? 'bi-arrows-angle-contract'
              : 'bi-arrows-angle-expand'
          "></i>
          </button>
        </div>

        <!-- CHART -->
        <div class="container_data">
          <div class="line-wrapper">
            <canvas #lineChart></canvas>
          </div>
        </div>

      </div>
    </div>


  </div>
</div>

<div class="back-button">
  <app-back-button></app-back-button>
</div>