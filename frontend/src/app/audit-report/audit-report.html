<header>
  <app-menu></app-menu>
</header>


<div class="report-container">

  <div class="audit-container">


    <app-filter *ngIf="showFilter" (buildingSelected)="onBuildingSelected($event)"></app-filter>

    <!-- Contenuto pagina Action Plan -->
    <div *ngIf="!showFilter">
      <div class="info-box">
        <p><strong>Project:</strong> {{ selectedProjectName }}</p>
        <p><strong>Building:</strong> {{ selectedBuildingName }}</p>
      </div>




      <!-- ✅ BOTTONI BER (Actual / Potential) -->
      <div class="ber-container">
        <h2>Building Energy Rating (BER)</h2>

        <div class="ber">
          <div class="actual">
            <button value="D2" (click)="showRating('D2')">D2</button>
            <span>Actual</span>
          </div>

          <div class="potential">
            <button value="A3" (click)="showRating('A3')">A3</button>
            <span>Potential</span>
          </div>
        </div>
      </div>

      <!-- ✅ ENERGY RATING: VISIBILE SOLO DOPO CLICK -->
      <div class="energy-rating-container" *ngIf="selectedRating">

        <!-- Close button (X) -->
        <button class="close-btn" (click)="selectedRating = null">✕</button>

        <!-- SCALA EFFICIENZA -->
        <div class="ber-model">
          <div class="title">
            <h3>Building Energy Rating</h3>
            <h3>(indicator)</h3>
            <h3>MOST EFFICIENT</h3>
          </div>

          <div class="efficiency-scale">
            <div *ngFor="let level of efficiencyLevels" class="efficiency-level" [ngClass]="level.code">
              <span class="range">{{ level.range }}</span>
              <span class="code">{{ level.code }}</span>
            </div>

            <!-- Indicatore attuale -->
            <div class="current-indicator" [style.top.%]="currentIndicatorPosition">
              <span>{{ currentLevel.code }}</span>
              <span>{{ currentLevel.value }} kWh/m²/yr</span>
            </div>
          </div>
        </div>


        <!-- SCALA EMISSIONI CO2 -->
        <div class="co2-indicator-container">

          <h3>Carbon Dioxide (CO2)<br>Emission Indicator</h3>

          <div class="co2-scale">

            <div class="co2-value-label">BEST<br>0</div>

            <div class="co2-bar"></div>

            <div class="co2-value-label bottom">WORST<br>> 3.0</div>

            <div class="co2-indicator" [style.top.%]="currentCO2Position">
              <div class="co2-numbers">
                12 KgCO2/m²/yr<br>0.27
              </div>
            </div>

          </div>
        </div>

      </div>
      <!-- ✅ END ENERGY RATING -->



      <!-- ✅ CHECKLIST COMPLETA -->
      <div class="checklist-container container my-4">
        <div class="content">

          <h2>Site tour checklist</h2>
          <p>The table below shows which areas of your site the auditor checked on during the site visit.</p>

          <table class="table checklist-table">

            <thead>
              <tr>
                <th class="text-start"></th>
                <th class="yes-no-na">Yes</th>
                <th class="yes-no-na">No</th>
                <th class="yes-no-na">N/A</th>
                <th class="text-start" style="min-width: 300px;">Observations & Comments</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let item of checklist; let i = index">
                <td>{{ item.label }}</td>

                <td class="checkbox-cell">
                  <input type="checkbox" [checked]="item.yes" (change)="toggleSelection(item, 'yes')">



                </td>

                <td class="checkbox-cell">
                  <input type="checkbox" [checked]="item.no" (change)="toggleSelection(item, 'no')">
                </td>

                <td class="checkbox-cell">
                  <input type="checkbox" [checked]="item.na" (change)="toggleSelection(item, 'na')">
                </td>

                <td class="observations">
                  <div class="editable" contenteditable="true" (input)="updateComment($event, item)"></div>

                </td>
              </tr>
            </tbody>

          </table>

<div class="checklist-actions">
  <button class="save-checklist-btn" (click)="saveChecklist()">Save Checklist</button>
</div>


        </div>
      </div>



    </div>

  </div>
  <div class="back-button">
    <app-back-button></app-back-button>
  </div>