<header>
  <app-menu></app-menu>
</header>


<div class="report-container">

  <div class="audit-container">

    <app-filter *ngIf="showFilter" (buildingSelected)="onBuildingSelected($event)"></app-filter>

    <!-- Contenuto pagina Action Plan -->
    <div *ngIf="!showFilter">
      <div class="info-box">
        <p><strong>Project:</strong> {{ selectedProjectName }}</p>
        <p><strong>Building:</strong> {{ selectedBuildingName }}</p>
            <div class="filter-toggle" style="text-align: right; margin-bottom: 1rem;">
  <button class="btn" (click)="toggleFilter()">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-home-move"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2" /><path d="M19 12h2l-9 -9l-9 9h2v7a2 2 0 0 0 2 2h5.5" /><path d="M16 19h6" /><path d="M19 16l3 3l-3 3" /></svg>
    {{ showFilter ? 'Close Building Selection' : 'Change Building' }}
  </button>
</div>
      </div>




      <!-- ✅ BOTTONI BER (Actual / Potential) -->
      <div class="ber-container">
        <h2>Building Energy Rating (BER)</h2>

        <div class="ber">
          <div class="actual">
            <button value="D2" (click)="showRating('D2')">D2</button>
            <span>Actual</span>
          </div>

          <div class="potential">
            <button value="A3" (click)="showRating('A3')">A3</button>
            <span>Potential</span>
          </div>
        </div>
      </div>

      <!-- ✅ ENERGY RATING: VISIBILE SOLO DOPO CLICK -->
      <div class="energy-rating-container" *ngIf="selectedRating">

        <!-- Close button (X) -->
        <button class="close-btn" (click)="selectedRating = null">✕</button>

        <!-- SCALA EFFICIENZA -->
        <div class="ber-model">
          <div class="title">
            <h3>Building Energy Rating</h3>
            <h3>(indicator)</h3>
            <h3>MOST EFFICIENT</h3>
          </div>

          <div class="efficiency-scale">
            <div *ngFor="let level of efficiencyLevels" class="efficiency-level" [ngClass]="level.code">
              <span class="range">{{ level.range }}</span>
              <span class="code">{{ level.code }}</span>
            </div>

            <!-- Indicatore attuale -->
            <div class="current-indicator" [style.top.%]="currentIndicatorPosition">
              <span>{{ currentLevel.code }}</span>
              <span>{{ currentLevel.value }} kWh/m²/yr</span>
            </div>
          </div>
        </div>


        <!-- SCALA EMISSIONI CO2 -->
        <div class="co2-indicator-container">

          <h3>Carbon Dioxide (CO2)<br>Emission Indicator</h3>

          <div class="co2-scale">

            <div class="co2-value-label">BEST<br>0</div>

            <div class="co2-bar"></div>

            <div class="co2-value-label bottom">WORST<br>> 3.0</div>

            <div class="co2-indicator" [style.top.%]="currentCO2Position">
              <div class="co2-numbers">
                12 KgCO2/m²/yr<br>0.27
              </div>
            </div>

          </div>
        </div>

      </div>
      <!-- ✅ END ENERGY RATING -->



      <!-- ✅ CHECKLIST COMPLETA -->
      <div class="checklist-container container my-4">
        <div class="content">

          <h2>Site tour checklist</h2>
          <p>The table below shows which areas of your site the auditor checked on during the site visit.</p>

          <table class="table checklist-table">

            <thead>
              <tr>
                <th class="text-start"></th>
                <th class="yes-no-na">Yes</th>
                <th class="yes-no-na">No</th>
                <th class="yes-no-na">N/A</th>
                <th class="text-start" style="min-width: 300px;">Observations & Comments</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let item of checklist; let i = index">
                <td>{{ item.label }}</td>

                <td class="checkbox-cell">
                  <input type="checkbox" [checked]="item.yes" (change)="toggleSelection(item, 'yes')">



                </td>

                <td class="checkbox-cell">
                  <input type="checkbox" [checked]="item.no" (change)="toggleSelection(item, 'no')">
                </td>

                <td class="checkbox-cell">
                  <input type="checkbox" [checked]="item.na" (change)="toggleSelection(item, 'na')">
                </td>

                <td class="observations">
  <div class="editable"
       contenteditable="true"
       (input)="updateComment($event, item)"
       [innerText]="item.comment">
  </div>
</td>

              </tr>
            </tbody>

          </table>

<div class="checklist-actions">
  <button class="save-checklist-btn" (click)="saveChecklist()">Save Checklist</button>
</div>


        </div>
      </div>



    </div>

  </div>
  <div class="back-button">
    <app-back-button></app-back-button>
  </div>